@inject BackgroundDataService BackgroundDataService
@inject NavigationManager Navigation

<MudContainer>
    @if (errorMessage != null)
    {
        <MudAlert Severity="Severity.Error">
            <MudText>@errorMessage</MudText>
            <MudButton OnClick="Retry" Variant="Variant.Filled" Color="Color.Primary">
                Retry
            </MudButton>
        </MudAlert>
    }
    else
    {
        <MudGrid Justify="Justify.Center">
            <MudItem>
                <MudProgressCircular Indeterminate="true" Size="Size.Large" />
            </MudItem>
            <MudItem>
                <MudText Typo="Typo.h6">@statusMessage</MudText>
            </MudItem>
        </MudGrid>
    }
</MudContainer>

@code {
    private string statusMessage = "Initializing application...";
    private string? errorMessage = null;

    protected override void OnInitialized()
    {
        // if (BackgroundDataService.IsInitialSyncComplete)
        // {
        //     Navigation.NavigateTo("/");
        //     return;
        // }

        BackgroundDataService.InitialSyncCompleted += () => Navigation.NavigateTo("/");
        BackgroundDataService.InitialSyncFailed += ex => 
        {
            errorMessage = $"Initialization failed: {ex.Message}";
            StateHasChanged();
        };
    }

    private void Retry()
    {
        errorMessage = null;
        BackgroundDataService.StartBackgroundTasks();
        StateHasChanged();
    }
}